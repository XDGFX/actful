<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>actful - alternative products for a better world</title>

  <!-- Scripts for style, CSS, etc -->
  <link rel="stylesheet" href="bulma.css">
  <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Custom font for title -->
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700&display=swap" rel="stylesheet">

  <!-- Custom selection colours... oooh fancy! -->
  <style>
  ::-moz-selection { /* Code for Firefox */
    color: white;
    background: #00d1b2;
  }

  ::selection {
    color: white;
    background: #00d1b2;
  }

  a:link {
    color: hsl(0, 0%, 21%);
  }

  a:visited {
    color: grey;
  }

  a:hover {
    color: #00d1b2;
  }

  /* Setting height of page to 100% so background colour can be changed down the line (dark mode anyone?) */
  body {
    height: 100%;
  }

  html {
    height: 100%;
  }

  </style>
</head>

<body>
  <section class="section">
    <div class="container">

      <!-- Title -->
      <h1 style="font-family: 'Montserrat', sans-serif; font-weight: bold; font-size: 1000%; text-align: center; padding-top: 10%">
        actful<font color="#00d1b2">.</font></h1>

        <!-- Subtitle -->
        <p class="subtitle" style="text-align: center; margin-top: -3%; margin-bottom: 3%;">
          alternative products which promote a <strong>sustainable</strong> future for all.
        </p>

        <!-- Search -->
        <div class="container" style="max-width: 600px;">
          <div class="control has-icons-left">
            <input class="input is-rounded" id="search-string" placeholder="search for a product..." autofocus>
            <span class="icon is-small is-left">
              <i class="fas fa-search"></i>
            </span>
          </div>
        </div>

        <!-- Search results -->
        <div class="container" style="max-width: 500px;">
          <br>
          <table id="results" style="font-size: 18px; width: 100%"></table>
        </div>

        <!-- Search -->
        <script type="text/javascript" src="products.json"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.4.5/fuse.min.js"></script>

        <script>

        // Finding all unique categories from JSON
        var lookup = {};
        var uniqueItems = [];

        for (var item, i = 0; item = products[i++];) {
          var category = item.category;

          if (!(category in lookup)) {
            lookup[category] = 1;
            uniqueItems.push(category);
          }
        }

        // Options for Fuse
        var options = {
          shouldSort: true,
          tokenize: true,
          findAllMatches: true,
          threshold: 0.6,
          location: 0,
          distance: 100,
          maxPatternLength: 32,
          minMatchCharLength: 1,
        };

        // Create Fuse search
        var fuse = new Fuse(uniqueItems, options);
        var result = {};

        // Search function
        $('#search-string').on('input', function() {
          var searchString = document.getElementById("search-string").value;
          var result = fuse.search(searchString);

          var outputList = "";

          // Look through results and create a html string
          for (value in result) {
            product = uniqueItems[result[value]];
            var outputList = outputList + "<tr> <td> <a href=\"products.htm?"
            + encodeURIComponent(product).replace('%20','+') + "\"</a>" + product + "</td> </tr>";
          };

          // Output results to results table
          document.getElementById("results").innerHTML = outputList;

          // Clearing table if searchbox is empty
          if(searchString.length == 0) {
            var outputList = "<tr> <td> </td> </tr>";
            document.getElementById("results").innerHTML = outputList;
          };
        });

        </script>

      </div>

    </section>

  </body>
  </html>
